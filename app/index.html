<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ponto Menos</title>
  
  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" href="icons/favicon.ico"/>
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png"/>
  <!-- PWA -->
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#111111"/>
  <meta name="description" content="Para bater ponto e consultar banco de horas sem um Super App"/>
  
  <!-- Mobile Web App -->
  <meta name="mobile-web-app-capable" content="yes"/>
  
  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Ponto Menos"/>
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png"/>
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css"/>
  
  <!-- Config (carrega primeiro para detecção de path) -->
  <script type="module" src="config.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Ponto Menos</h1>
    <p class="hint" style="margin-top:-8px; margin-bottom:16px;">Para bater ponto e consultar banco de horas sem um "Super App"</p>

    <!-- Tela de Login -->
    <div id="loginScreen" style="display:none;">
      <div class="card">
        <h3 style="margin-bottom:16px;">Entre com o seu mesmo login do <a href="https://app2.pontomais.com.br" target="_blank">Ponto Mais</a></h3>
        <div style="margin-bottom:12px;">
          <input id="email" placeholder="Nome de usuário / cpf / e-mail"/>
        </div>
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-size:14px;">Senha</label>
          <div style="position:relative;">
            <input id="password" type="password" placeholder="••••••••" style="padding-right:40px;"/>
            <button id="togglePassword" type="button" aria-label="Mostrar senha" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:transparent; border:0; padding:4px; cursor:pointer;">
              <svg id="iconEyeOpen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;">
                <path d="M12 5c-4.5 0-8.3 3-9.6 7 1.3 4 5.1 7 9.6 7s8.3-3 9.6-7c-1.3-4-5.1-7-9.6-7z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg id="iconEyeClosed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5c-4.5 0-8.3 3-9.6 7 1.3 4 5.1 7 9.6 7s8.3-3 9.6-7c-1.3-4-5.1-7-9.6-7z"/>
                <circle cx="12" cy="12" r="3"/>
                <line x1="4" y1="4" x2="20" y2="20"/>
              </svg>
            </button>
          </div>
        </div>
        <div>
          <button id="loginBtn" style="width:100%;">Entrar</button>
        </div>
        <span id="loginStatus" class="hint" style="display:block;margin-top:12px;text-align:center;"></span>
      </div>
    </div>

    <!-- Painel Principal -->
    <div id="mainPanel" style="display:none;">
      <div class="card">
        <!-- Botões no topo -->
        <div class="row" style="gap:8px;">
          <button id="punchBtn" class="primary" style="flex:1;">Bater Ponto</button>
          <button class="secondary" id="refreshBtn" style="flex:0.5;">Atualizar</button>
          <button class="secondary" id="logoutBtn" style="flex:0.5;">Sair</button>
        </div>

        <!-- Linha 1: Último ponto e Banco de horas -->
        <div class="row" style="margin-top:12px;">
          <div class="col kpi" style="flex:1;">
            <div class="label">Último ponto</div>
            <div class="ultimo-ponto-info">
              <div class="value" id="ultimoPontoData" style="margin:0;">—</div>
              <div class="value" id="ultimoPontoHora" style="margin:0;">—</div>
            </div>
          </div>
          <div class="col kpi" style="flex:1;">
            <div class="label">
              Banco de horas
              <span class="tooltip-icon" id="tooltipBanco" style="display:none;">
                <span class="icon">ⓘ</span>
                <span class="tooltip-text" id="tooltipBancoText"></span>
              </span>
            </div>
            <div class="banco-info">
              <div class="value" id="bancoHoras" style="margin:0;">—</div>
              <small class="hint" id="bancoVencimento" style="white-space:nowrap; font-size:11px;"></small>
            </div>
          </div>
        </div>

        <!-- Linha 2: Horas trabalhadas hoje, Finalizar dia às, Horário limite -->
        <div class="row" style="margin-top:8px;">
          <div class="col kpi">
            <div class="label">Horas trabalhadas hoje</div>
            <div class="value" id="horasHoje">—</div>
          </div>
          <div class="col kpi">
            <div class="label">
              Finalizar dia às
              <span class="tooltip-icon" id="tooltipFinalizar">
                <span class="icon">ⓘ</span>
                <span class="tooltip-text" id="tooltipFinalizarText"></span>
              </span>
            </div>
            <div class="value" id="finalizarAs">—</div>
          </div>
          <div class="col kpi">
            <div class="label">
              Horário limite
              <span class="tooltip-icon" id="tooltipLimite">
                <span class="icon">ⓘ</span>
                <span class="tooltip-text" id="tooltipLimiteText"></span>
              </span>
            </div>
            <div class="value" id="horarioLimite">—</div>
          </div>
        </div>

        <div class="punch-list">
          <h4>Pontos batidos hoje</h4>
          <div id="punchList"></div>
        </div>
      </div>

      <div class="footer-hints">
        <p class="hint">Dica: após rodar no celular, use "Adicionar à Tela Inicial" para abrir como app.</p>
        <p class="hint">Reporte bugs <a href="https://github.com/rodrigofigueiredo005/pontomenos/issues" target="_blank">aqui</a></p>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Modal de Confirmação de Ponto -->
  <div class="modal-overlay" id="punchModal">
    <div class="modal">
      <h3>Confirmar registro de ponto</h3>
      
      <p class="hint">Selecione a localização:</p>
      <div id="locationOptions"></div>

      <div class="modal-buttons">
        <button class="secondary" id="cancelPunchBtn">Cancelar</button>
        <button id="confirmPunchBtn">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Mostrar/ocultar senha -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var input = document.getElementById('password');
      var btn = document.getElementById('togglePassword');
      var eyeOpen = document.getElementById('iconEyeOpen');
      var eyeClosed = document.getElementById('iconEyeClosed');
      if (!input || !btn) return;
      btn.addEventListener('click', function () {
        var showing = input.type === 'text';
        input.type = showing ? 'password' : 'text';
        if (eyeOpen && eyeClosed) {
          eyeOpen.style.display = showing ? 'none' : 'block';
          eyeClosed.style.display = showing ? 'block' : 'none';
        }
        btn.setAttribute('aria-label', input.type === 'text' ? 'Ocultar senha' : 'Mostrar senha');
      });
    });
  </script>
  <!-- JavaScript -->
  <script type="module" src="app.js"></script>

</body>
</html>
